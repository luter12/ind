// QuantumTrade PRO v1.0 - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –¥–ª—è –∫—Ä–∏–ø—Ç–æ—Ç—Ä–µ–π–¥–∏–Ω–≥–∞
// @version=5
strategy("QuantumTrade PRO", shorttitle="QTPRO", overlay=true, pyramiding=0, 
         default_qty_type=strategy.percent_of_equity, default_qty_value=10, 
         initial_capital=10000, currency=currency.USD, commission_type=strategy.commission.percent,
         commission_value=0.075, max_bars_back=5000)

//------------------------------ –û–°–ù–û–í–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò ------------------------------//
var g_header = "‚ö° QuantumTrade PRO - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–π–¥–∏–Ω–≥"

// –ì—Ä—É–ø–ø–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã
var g_mode = "üõ†Ô∏è –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã"
useStrategy = input.bool(false, "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —Ç–æ—Ä–≥–æ–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é (–±—ç–∫—Ç–µ—Å—Ç)", group=g_mode, tooltip="–í–∫–ª—é—á–∏—Ç–µ –¥–ª—è –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏")
useAlerts = input.bool(true, "–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", group=g_mode)
riskPerTrade = input.float(1.0, "–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É (%)", minval=0.1, maxval=10.0, step=0.1, group=g_mode, tooltip="–ü—Ä–æ—Ü–µ–Ω—Ç –∫–∞–ø–∏—Ç–∞–ª–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –Ω–∞ –æ–¥–Ω—É —Å–¥–µ–ª–∫—É")
enableML = input.bool(true, "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã", group=g_mode, tooltip="–í–∫–ª—é—á–∞–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞")

// –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∏—Å–∫–∞–º–∏
var g_risk = "‚ö†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–∞–º–∏"
useStopLoss = input.bool(true, "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–æ–ø-–ª–æ—Å—Å", group=g_risk)
useTakeProfit = input.bool(true, "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç", group=g_risk)
useTrailingStop = input.bool(true, "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø", group=g_risk)
stopLossPercent = input.float(2.0, "–°—Ç–æ–ø-–ª–æ—Å—Å (%)", minval=0.5, maxval=10.0, step=0.1, group=g_risk)
takeProfitPercent = input.float(3.0, "–¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç (%)", minval=0.5, maxval=20.0, step=0.1, group=g_risk)
trailingStopPercent = input.float(1.5, "–¢—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø (%)", minval=0.5, maxval=10.0, step=0.1, group=g_risk)

// –ì—Ä—É–ø–ø–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
var g_indicators = "üìä –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã"
// MA –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
var g_ma = "üìà –°–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ä–µ–¥–Ω–∏–µ"
fastLength = input.int(9, "–ë—ã—Å—Ç—Ä–∞—è MA (–ø–µ—Ä–∏–æ–¥—ã)", minval=1, group=g_ma)
slowLength = input.int(21, "–ú–µ–¥–ª–µ–Ω–Ω–∞—è MA (–ø–µ—Ä–∏–æ–¥—ã)", minval=1, group=g_ma)
longLength = input.int(50, "–î–ª–∏–Ω–Ω–∞—è MA (–ø–µ—Ä–∏–æ–¥—ã)", minval=1, group=g_ma)
fastType = input.string("EMA", "–¢–∏–ø –±—ã—Å—Ç—Ä–æ–π MA", options=["SMA", "EMA", "WMA", "VWMA", "HMA", "ALMA"], group=g_ma)
slowType = input.string("EMA", "–¢–∏–ø –º–µ–¥–ª–µ–Ω–Ω–æ–π MA", options=["SMA", "EMA", "WMA", "VWMA", "HMA", "ALMA"], group=g_ma)
longType = input.string("SMA", "–¢–∏–ø –¥–ª–∏–Ω–Ω–æ–π MA", options=["SMA", "EMA", "WMA", "VWMA", "HMA", "ALMA"], group=g_ma)

// –ì—Ä—É–ø–ø–∞ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–æ–≤
var g_osc = "üîÑ –û—Å—Ü–∏–ª–ª—è—Ç–æ—Ä—ã"
rsiLength = input.int(14, "RSI (–ø–µ—Ä–∏–æ–¥—ã)", minval=1, group=g_osc)
rsiOverbought = input.int(70, "RSI —É—Ä–æ–≤–µ–Ω—å –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç–∏", minval=50, maxval=100, group=g_osc)
rsiOversold = input.int(30, "RSI —É—Ä–æ–≤–µ–Ω—å –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç–∏", minval=0, maxval=50, group=g_osc)
useMACD = input.bool(true, "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MACD", group=g_osc)
macdFast = input.int(12, "MACD –±—ã—Å—Ç—Ä–∞—è –ª–∏–Ω–∏—è", minval=1, group=g_osc)
macdSlow = input.int(26, "MACD –º–µ–¥–ª–µ–Ω–Ω–∞—è –ª–∏–Ω–∏—è", minval=1, group=g_osc)
macdSignal = input.int(9, "MACD —Å–∏–≥–Ω–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è", minval=1, group=g_osc)

// –ì—Ä—É–ø–ø–∞ –æ–±—ä–µ–º–Ω—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
var g_vol = "üìä –û–±—ä–µ–º–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã"
useVolume = input.bool(true, "–£—á–∏—Ç—ã–≤–∞—Ç—å –æ–±—ä–µ–º –≤ –∞–Ω–∞–ª–∏–∑–µ", group=g_vol)
volumeLength = input.int(20, "–ü–µ—Ä–∏–æ–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –æ–±—ä–µ–º–∞", group=g_vol)
obv_length = input.int(14, "OBV SMA (–ø–µ—Ä–∏–æ–¥—ã)", group=g_vol, tooltip="On-Balance Volume —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ")
mfi_length = input.int(14, "MFI (–ø–µ—Ä–∏–æ–¥—ã)", group=g_vol, tooltip="Money Flow Index")

// –ú—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º-–∞–Ω–∞–ª–∏–∑
var g_mtf = "‚è±Ô∏è –ú—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º"
useMTF = input.bool(true, "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º-–∞–Ω–∞–ª–∏–∑", group=g_mtf)
mtfRatio = input.string("4", "–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å—Ç–∞—Ä—à–µ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞", options=["2", "3", "4", "6", "8", "12", "16", "24"], group=g_mtf)

// –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Ä–æ–≤–Ω–µ–π
var g_levels = "üîç –£—Ä–æ–≤–Ω–∏ –∏ –∑–æ–Ω—ã"
useSR = input.bool(true, "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É—Ä–æ–≤–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è", group=g_levels)
srPeriod = input.int(14, "–ü–µ—Ä–∏–æ–¥ –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—Ä–æ–≤–Ω–µ–π", minval=5, group=g_levels)
srDistance = input.float(1.0, "–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏ (%)", minval=0.1, group=g_levels)
srStrength = input.int(3, "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∏–ª–∞ —É—Ä–æ–≤–Ω—è (–∫–∞—Å–∞–Ω–∏—è)", minval=2, group=g_levels)

// –í–∏–∑—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
var g_visual = "üé® –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è"
colorMode = input.string("–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π", "–†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è", options=["–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π", "–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π"], group=g_visual)
baseColor = input.color(#2962FF, "–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç", group=g_visual)
buyColor = input.color(#00E676, "–¶–≤–µ—Ç —Å–∏–≥–Ω–∞–ª–∞ –ø–æ–∫—É–ø–∫–∏", group=g_visual)
sellColor = input.color(#FF1744, "–¶–≤–µ—Ç —Å–∏–≥–Ω–∞–ª–∞ –ø—Ä–æ–¥–∞–∂–∏", group=g_visual)
showLabels = input.bool(true, "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–µ—Ç–∫–∏ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ", group=g_visual)
showDashboard = input.bool(true, "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è", group=g_visual)
dashboardPosition = input.string("–ü—Ä–∞–≤—ã–π –Ω–∏–∂–Ω–∏–π", "–ü–æ–∑–∏—Ü–∏—è –ø–∞–Ω–µ–ª–∏", 
                               options=["–õ–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π", "–ü—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π", "–õ–µ–≤—ã–π –Ω–∏–∂–Ω–∏–π", "–ü—Ä–∞–≤—ã–π –Ω–∏–∂–Ω–∏–π"], 
                               group=g_visual)

// –î–∞–Ω–Ω—ã–µ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
var g_alerts = "üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"
alertFrequency = input.string("–ö–∞–∂–¥—ã–π —Å–∏–≥–Ω–∞–ª", "–ß–∞—Å—Ç–æ—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π", 
                             options=["–ö–∞–∂–¥—ã–π —Å–∏–≥–Ω–∞–ª", "–¢–æ–ª—å–∫–æ —Å–∏–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã", "–û–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Ç—Ä–µ–Ω–¥"], 
                             group=g_alerts)
alertSound = input.string("–ó–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è", options=["–ù–µ—Ç", "–¢–∏—Ö–∏–π", "–°—Ä–µ–¥–Ω–∏–π", "–ì—Ä–æ–º–∫–∏–π"], group=g_alerts)

//------------------------------ –§–£–ù–ö–¶–ò–ò ------------------------------//
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è MA –Ω—É–∂–Ω–æ–≥–æ —Ç–∏–ø–∞
getMA(source, length, type) =>
    switch type
        "SMA" => ta.sma(source, length)
        "EMA" => ta.ema(source, length)
        "WMA" => ta.wma(source, length)
        "VWMA" => ta.vwma(source, length)
        "HMA" => ta.hma(source, length)
        "ALMA" => ta.alma(source, length, 0.85, 6)
        => ta.sma(source, length)  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é SMA

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –¥—Ä—É–≥–æ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞
getMtfData(source, ratio) =>
    tf = switch ratio
        "2" => timeframe.period + ":2"
        "3" => timeframe.period + ":3"
        "4" => timeframe.period + ":4"
        "6" => timeframe.period + ":6"
        "8" => timeframe.period + ":8"
        "12" => timeframe.period + ":12"
        "16" => timeframe.period + ":16"
        "24" => timeframe.period + ":24"
        => timeframe.period + ":4"
    request.security(syminfo.tickerid, tf, source)

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
detectSRLevels(lookback, minStrength, distancePercent) =>
    var pivotHighs = array.new_float(0)
    var pivotLows = array.new_float(0)
    var pivotHighStrength = array.new_int(0)
    var pivotLowStrength = array.new_int(0)
    
    // –ù–∞—Ö–æ–¥–∏–º –≤–µ—Ä—à–∏–Ω—ã –∏ –≤–ø–∞–¥–∏–Ω—ã
    ph = ta.pivothigh(high, lookback, lookback)
    pl = ta.pivotlow(low, lookback, lookback)
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –≤–µ—Ä—à–∏–Ω—É
    if not na(ph)
        array.push(pivotHighs, ph)
        array.push(pivotHighStrength, 1)
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –≤–ø–∞–¥–∏–Ω—É
    if not na(pl)
        array.push(pivotLows, pl)
        array.push(pivotLowStrength, 1)
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–∏–∑–æ—Å—Ç—å —Ü–µ–Ω—ã –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —É—Ä–æ–≤–Ω—è–º
    for i = 0 to array.size(pivotHighs) - 1
        level = array.get(pivotHighs, i)
        strength = array.get(pivotHighStrength, i)
        
        // –ï—Å–ª–∏ —Ü–µ–Ω–∞ –ø—Ä–∏–±–ª–∏–∑–∏–ª–∞—Å—å –∫ —É—Ä–æ–≤–Ω—é —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
        if high >= level * (1 - distancePercent / 100) and high <= level * (1 + distancePercent / 100)
            array.set(pivotHighStrength, i, strength + 1)
    
    for i = 0 to array.size(pivotLows) - 1
        level = array.get(pivotLows, i)
        strength = array.get(pivotLowStrength, i)
        
        // –ï—Å–ª–∏ —Ü–µ–Ω–∞ –ø—Ä–∏–±–ª–∏–∑–∏–ª–∞—Å—å –∫ —É—Ä–æ–≤–Ω—é –ø–æ–¥–¥–µ—Ä–∂–∫–∏
        if low >= level * (1 - distancePercent / 100) and low <= level * (1 + distancePercent / 100)
            array.set(pivotLowStrength, i, strength + 1)
    
    // –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–∏–ª—å–Ω—ã–µ —É—Ä–æ–≤–Ω–∏
    var resistanceLevels = array.new_float(0)
    var supportLevels = array.new_float(0)
    
    for i = 0 to array.size(pivotHighs) - 1
        if array.get(pivotHighStrength, i) >= minStrength
            array.push(resistanceLevels, array.get(pivotHighs, i))
    
    for i = 0 to array.size(pivotLows) - 1
        if array.get(pivotLowStrength, i) >= minStrength
            array.push(supportLevels, array.get(pivotLows, i))
            
    [resistanceLevels, supportLevels]

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ–µ "ML")
predictiveTrend(price, fastMA, slowMA, longMA, rsi, macd, signal) =>
    // –í—ã—á–∏—Å–ª—è–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    var recentSuccess = array.new_float(20, 0.5)  // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ (0-1)
    var totalWeight = 0.0
    
    // 1. –û—Ü–µ–Ω–∏–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ MA
    ma_factor = fastMA > slowMA and slowMA > longMA ? 1.0 : 
                fastMA < slowMA and slowMA < longMA ? -1.0 :
                fastMA > slowMA and slowMA < longMA ? 0.3 :
                fastMA < slowMA and slowMA > longMA ? -0.3 : 0.0
                
    // 2. RSI —Ñ–∞–∫—Ç–æ—Ä
    rsi_factor = rsi < 30 ? 1.0 : 
                 rsi > 70 ? -1.0 :
                 rsi < 45 ? 0.5 :
                 rsi > 55 ? -0.5 : 0.0
                 
    // 3. MACD —Ñ–∞–∫—Ç–æ—Ä
    macd_factor = macd > signal and macd > 0 ? 1.0 :
                  macd < signal and macd < 0 ? -1.0 :
                  macd > signal ? 0.5 :
                  macd < signal ? -0.5 : 0.0
    
    // 4. –í—ã—á–∏—Å–ª—è–µ–º –≤–µ—Å –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–∫—Ç–æ—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞
    ma_weight = 0.4
    rsi_weight = 0.3
    macd_weight = 0.3
    
    // 5. –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω ML, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –≤–µ—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏
    if enableML
        // –ê–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N –±–∞—Ä–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
        success_rate = array.avg(recentSuccess)
        
        if success_rate > 0.6  // –ï—Å–ª–∏ –±–æ–ª–µ–µ 60% —É—Å–ø–µ—à–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤–µ—Å –±–æ–ª–µ–µ —É—Å–ø–µ—à–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤
            if math.abs(ma_factor) > math.abs(rsi_factor) and math.abs(ma_factor) > math.abs(macd_factor)
                ma_weight := 0.5
                rsi_weight := 0.25
                macd_weight := 0.25
            else if math.abs(rsi_factor) > math.abs(ma_factor) and math.abs(rsi_factor) > math.abs(macd_factor)
                ma_weight := 0.3
                rsi_weight := 0.5
                macd_weight := 0.2
            else
                ma_weight := 0.3
                rsi_weight := 0.2
                macd_weight := 0.5
    
    // 6. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é –æ—Ü–µ–Ω–∫—É —Ç—Ä–µ–Ω–¥–∞
    trend_score = ma_factor * ma_weight + rsi_factor * rsi_weight + macd_factor * macd_weight
    
    // 7. –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é —É—Å–ø–µ—Ö–∞ (–ø—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –∏ —Ü–µ–Ω–∞ –ø–æ—à–ª–∞ –≤–≤–µ—Ä—Ö)
    if bar_index > 20
        predicted = array.get(recentSuccess, 0)
        realized = close > close[5] ? 1.0 : 0.0  // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –≤—ã—Ä–æ—Å–ª–∞ –ª–∏ —Ü–µ–Ω–∞ –∑–∞ 5 –±–∞—Ä–æ–≤
        success = predicted > 0.5 and realized == 1.0 ? 1.0 : 
                  predicted < 0.5 and realized == 0.0 ? 1.0 : 0.0
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å–∫–æ–ª—å–∑—è—â–∏–º –æ–±—Ä–∞–∑–æ–º
        array.shift(recentSuccess)
        array.push(recentSuccess, success)
    
    trend_score

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–±—ä–µ–º–Ω—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
calculateVolumeIndicators(price, vol) =>
    // On-Balance Volume
    obv_raw = ta.cum(math.sign(price - price[1]) * vol)
    obv_smooth = ta.sma(obv_raw, obv_length)
    
    // Money Flow Index
    mfi = ta.mfi(price, vol, mfi_length)
    
    // –û—Ü–µ–Ω–∫–∞ –æ–±—ä–µ–º–∞
    vol_avg = ta.sma(vol, volumeLength)
    vol_ratio = vol / vol_avg
    
    [obv_raw, obv_smooth, mfi, vol_ratio]

//------------------------------ –û–°–ù–û–í–ù–´–ï –†–ê–°–ß–ï–¢–´ ------------------------------//
// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω –∏ –æ–±—ä–µ–º–∞
src = close
vol = volume

// –†–∞—Å—á–µ—Ç —Å–∫–æ–ª—å–∑—è—â–∏—Ö —Å—Ä–µ–¥–Ω–∏—Ö
fastMA = getMA(src, fastLength, fastType)
slowMA = getMA(src, slowLength, slowType)
longMA = getMA(src, longLength, longType)

// –†–∞—Å—á–µ—Ç –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–æ–≤
rsiValue = ta.rsi(src, rsiLength)
[macdLine, signalLine, histLine] = ta.macd(src, macdFast, macdSlow, macdSignal)

// –†–∞—Å—á–µ—Ç –æ–±—ä–µ–º–Ω—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
[obv, obv_sma, mfi, vol_ratio] = calculateVolumeIndicators(src, vol)

// –ú—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
var higher_trend = 0.0
var higher_rsi = 0.0
var higher_macd = 0.0

if useMTF
    higher_src = getMtfData(src, mtfRatio)
    higher_fastMA = getMtfData(getMA(src, fastLength, fastType), mtfRatio)
    higher_slowMA = getMtfData(getMA(src, slowLength, slowType), mtfRatio)
    higher_longMA = getMtfData(getMA(src, longLength, longType), mtfRatio)
    higher_rsi = getMtfData(rsiValue, mtfRatio)
    [higher_macd, higher_signal, _] = ta.macd(higher_src, macdFast, macdSlow, macdSignal)
    
    // –û—Ü–µ–Ω–∫–∞ —Ç—Ä–µ–Ω–¥–∞ –Ω–∞ —Å—Ç–∞—Ä—à–µ–º —Ç–∞–π–º—Ñ—Ä–µ–π–º–µ
    if higher_fastMA > higher_slowMA and higher_slowMA > higher_longMA
        higher_trend := 1.0
    else if higher_fastMA < higher_slowMA and higher_slowMA < higher_longMA
        higher_trend := -1.0
    else
        higher_trend := 0.0

// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
[resistanceLevels, supportLevels] = detectSRLevels(srPeriod, srStrength, srDistance)

// –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–¥–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
prediction = predictiveTrend(src, fastMA, slowMA, longMA, rsiValue, macdLine, signalLine)

// –ö–ª—é—á–µ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Ä—ã–Ω–æ–∫
// 1. –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ø–æ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—é
bullishCross = ta.crossover(fastMA, slowMA)
bearishCross = ta.crossunder(fastMA, slowMA)

// 2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ —É—Å–∏–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤
macd_bullish = macdLine > signalLine and macdLine > macdLine[1]
macd_bearish = macdLine < signalLine and macdLine < macdLine[1]
rsi_bullish = rsiValue < 50 and rsiValue > rsiValue[1]
rsi_bearish = rsiValue > 50 and rsiValue < rsiValue[1]
vol_bullish = useVolume ? vol_ratio > 1.2 and obv > obv[1] : true
vol_bearish = useVolume ? vol_ratio > 1.2 and obv < obv[1] : true

// 3. –£—Ä–æ–≤–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
near_support = false
near_resistance = false

if useSR
    for i = 0 to math.min(array.size(supportLevels) - 1, 5)  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ 5 –±–ª–∏–∂–∞–π—à–∏—Ö —É—Ä–æ–≤–Ω–µ–π
        support_level = array.get(supportLevels, i)
        if low >= support_level * 0.995 and low <= support_level * 1.01
            near_support := true
            break
            
    for i = 0 to math.min(array.size(resistanceLevels) - 1, 5)
        resistance_level = array.get(resistanceLevels, i)
        if high <= resistance_level * 1.005 and high >= resistance_level * 0.99
            near_resistance := true
            break

// 4. –£—á–∏—Ç—ã–≤–∞–µ–º –º—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º
mtf_aligned_bullish = useMTF ? higher_trend > 0 : true
mtf_aligned_bearish = useMTF ? higher_trend < 0 : true

// 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ML/–ø—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
ml_bullish = prediction > 0.3
ml_bearish = prediction < -0.3

// 6. –°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞ (–æ—Ç 0 –¥–æ 100)
buy_strength = 0.0
sell_strength = 0.0

// –ë–∞–∑–æ–≤–∞—è —Å–∏–ª–∞ –æ—Ç –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è MA (–¥–æ 40 –ø—É–Ω–∫—Ç–æ–≤)
if bullishCross
    buy_strength := 40
if bearishCross
    sell_strength := 40

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ—Ç –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–æ–≤ (–¥–æ 20 –ø—É–Ω–∫—Ç–æ–≤)
if macd_bullish
    buy_strength += 10
if rsi_bullish
    buy_strength += 10
if macd_bearish
    sell_strength += 10
if rsi_bearish
    sell_strength += 10

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ—Ç –æ–±—ä–µ–º–∞ (–¥–æ 10 –ø—É–Ω–∫—Ç–æ–≤)
if vol_bullish
    buy_strength += 10
if vol_bearish
    sell_strength += 10

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ—Ç –±–ª–∏–∑–æ—Å—Ç–∏ –∫ —É—Ä–æ–≤–Ω—è–º (–¥–æ 10 –ø—É–Ω–∫—Ç–æ–≤)
if near_support
    buy_strength += 10
if near_resistance
    sell_strength += 10

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ—Ç –º—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º–∞ (–¥–æ 10 –ø—É–Ω–∫—Ç–æ–≤)
if mtf_aligned_bullish
    buy_strength += 10
if mtf_aligned_bearish
    sell_strength += 10

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ—Ç ML (–¥–æ 10 –ø—É–Ω–∫—Ç–æ–≤)
if ml_bullish
    buy_strength += 10
if ml_bearish
    sell_strength += 10

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å/–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å
if rsiValue > rsiOverbought
    buy_strength *= 0.7  // –°–Ω–∏–∂–∞–µ–º —Å–∏–ª—É —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞ –ø–æ–∫—É–ø–∫—É
if rsiValue < rsiOversold
    sell_strength *= 0.7  // –°–Ω–∏–∂–∞–µ–º —Å–∏–ª—É —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞ –ø—Ä–æ–¥–∞–∂—É

// –§–∏–Ω–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã —Å —É—á–µ—Ç–æ–º —Å–∏–ª—ã –∏ –≤—Å–µ—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤
strongBuy = bullishCross and buy_strength >= 70 and src > longMA
strongSell = bearishCross and sell_strength >= 70 and src < longMA

//------------------------------ –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ò–ì–ù–ê–õ–ê–ú–ò –ò –¢–û–†–ì–û–í–õ–ï–ô ------------------------------//
// –õ–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞ –∏ –≤—ã—Ö–æ–¥–∞ –¥–ª—è —Ç–æ—Ä–≥–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
var float entryPrice = na
var float stopLoss = na
var float takeProfit = na

// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ö–æ–¥–∞–º–∏
if useStrategy
    // –í—Ö–æ–¥ –≤ –ø–æ–∫—É–ø–∫—É
    if strongBuy
        strategy.entry("Long", strategy.long)
        entryPrice := close
        stopLoss := close * (1 - stopLossPercent / 100)
        takeProfit := close * (1 + takeProfitPercent / 100)
    
    // –í—Ö–æ–¥ –≤ –ø—Ä–æ–¥–∞–∂—É
    if strongSell
        strategy.entry("Short", strategy.short)
        entryPrice := close
        stopLoss := close * (1 + stopLossPercent / 100)  // –î–ª—è —à–æ—Ä—Ç–∞ —Å—Ç–æ–ø –≤—ã—à–µ –≤—Ö–æ–¥–∞
        takeProfit := close * (1 - takeProfitPercent / 100)  // –î–ª—è —à–æ—Ä—Ç–∞ —Ç–µ–π–∫ –Ω–∏–∂–µ –≤—Ö–æ–¥–∞

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–ø-–ª–æ—Å—Å–æ–º
    if useStopLoss and not na(entryPrice)
        if strategy.position_size > 0  // –í –¥–ª–∏–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
            strategy.exit("SL/TP", "Long", stop=stopLoss, limit=takeProfit)
        else if strategy.position_size < 0  // –í –∫–æ—Ä–æ—Ç–∫–æ–π –ø–æ–∑–∏—Ü–∏–∏
            strategy.exit("SL/TP", "Short", stop=stopLoss, limit=takeProfit)
    
    // –¢—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø
    if useTrailingStop and strategy.position_size != 0
        trail_price = strategy.position_size > 0 ? 
                     high * (1 - trailingStopPercent / 100) : 
                     low * (1 + trailingStopPercent / 100)
        strategy.exit("Trail", trail_price=trail_price)

// –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
if useAlerts
    alertcondition(strongBuy, "QuantumTrade PRO - –°–∏–≥–Ω–∞–ª –Ω–∞ –ø–æ–∫—É–ø–∫—É", "–°–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª –Ω–∞ –ü–û–ö–£–ü–ö–£! –°–∏–ª–∞: " + str.tostring(math.round(buy_strength)) + "/100")
    alertcondition(strongSell, "QuantumTrade PRO - –°–∏–≥–Ω–∞–ª –Ω–∞ –ø—Ä–æ–¥–∞–∂—É", "–°–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª –Ω–∞ –ü–†–û–î–ê–ñ–£! –°–∏–ª–∞: " + str.tostring(math.round(sell_strength)) + "/100")

//------------------------------ –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø ------------------------------//
// –†–∞—Å—á–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ü–≤–µ—Ç–æ–≤
getDynamicColor(isUp, baseCol, intensity) =>
    if colorMode == "–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π"
        colorIntensity = math.min(math.max(intensity / 100, 0), 1)
        if isUp
            color.from_gradient(colorIntensity, 0, 1, color.new(color.white, 70), buyColor)
        else
            color.from_gradient(colorIntensity, 0, 1, color.new(color.white, 70), sellColor)
    else
        if isUp
            buyColor
        else
            sellColor

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–∫–æ–ª—å–∑—è—â–∏—Ö —Å—Ä–µ–¥–Ω–∏—Ö —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ —Ü–≤–µ—Ç–∞–º–∏
fastColor = getDynamicColor(fastMA > fastMA[1], baseColor, 100)
slowColor = getDynamicColor(slowMA > slowMA[1], baseColor, 80)
longColor = getDynamicColor(longMA > longMA[1], baseColor, 60)

plot(fastMA, "–ë—ã—Å—Ç—Ä–∞—è MA", color=fastColor, linewidth=2)
plot(slowMA, "–ú–µ–¥–ª–µ–Ω–Ω–∞—è MA", color=slowColor, linewidth=2)
plot(longMA, "–î–ª–∏–Ω–Ω–∞—è MA", color=longColor, linewidth=1)

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —É—Ä–æ–≤–Ω–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
if useSR
    for i = 0 to math.min(array.size(resistanceLevels) - 1, 5)
        level = array.get(resistanceLevels, i)
        line.new(bar_index - 50, level, bar_index, level, 
                 xloc=xloc.bar_index, color=color.new(color.red, 30), style=line.style_dashed, width=2)
        label.new(bar_index, level, "R" + str.tostring(i+1), 
                 color=color.new(color.red, 80), style=label.style_label_down, 
                 textcolor=color.white, size=size.small, xloc=xloc.bar_index)
    
    for i = 0 to math.min(array.size(supportLevels) - 1, 5)
        level = array.get(supportLevels, i)
        line.new(bar_index - 50, level, bar_index, level, 
                 xloc=xloc.bar_index, color=color.new(color.green, 30), style=line.style_dashed, width=2)
        label.new(bar_index, level, "S" + str.tostring(i+1), 
                 color=color.new(color.green, 80), style=label.style_label_up, 
                 textcolor=color.white, size=size.small, xloc=xloc.bar_index)

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
plotshape(strongBuy, title="–°–∏–≥–Ω–∞–ª –ø–æ–∫—É–ø–∫–∏", location=location.belowbar, 
          color=buyColor, style=shape.triangleup, size=size.normal)
plotshape(strongSell, title="–°–∏–≥–Ω–∞–ª –ø—Ä–æ–¥–∞–∂–∏", location=location.abovebar, 
          color=sellColor, style=shape.triangledown, size=size.normal)

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–∞
if showLabels and (strongBuy or strongSell)
    strength_value = strongBuy ? buy_strength : sell_strength
    label_text = strongBuy ? "‚Üë BUY: " + str.tostring(math.round(strength_value)) : 
                            "‚Üì SELL: " + str.tostring(math.round(strength_value))
    label_color = strongBuy ? color.new(buyColor, 20) : color.new(sellColor, 20)
    label.new(bar_index, strongBuy ? low * 0.998 : high * 1.002, 
              label_text, color=label_color, textcolor=color.white, 
              style=strongBuy ? label.style_label_up : label.style_label_down, 
              size=size.small, xloc=xloc.bar_index)

// –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –ø–∞–Ω–µ–ª–∏
if showDashboard
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–∞–Ω–µ–ª–∏
    panel_position = switch dashboardPosition
        "–õ–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π" => position.top_left
        "–ü—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π" => position.top_right
        "–õ–µ–≤—ã–π –Ω–∏–∂–Ω–∏–π" => position.bottom_left
        => position.bottom_right
    
    var table dashboardTable = table.new(panel_position, 2, 10, bgcolor=color.new(color.black, 80), border_width=1, border_color=color.new(color.white, 90))
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
    table.cell(dashboardTable, 0, 0, "QuantumTrade PRO", text_color=color.white, bgcolor=color.new(baseColor, 10), text_size=size.normal)
    table.cell(dashboardTable, 1, 0, syminfo.ticker, text_color=color.white, bgcolor=color.new(baseColor, 10), text_size=size.normal)
    
    // –¢–µ–∫—É—â–∏–π —Ç—Ä–µ–Ω–¥
    trendText = fastMA > slowMA and slowMA > longMA ? "–í–æ—Å—Ö–æ–¥—è—â–∏–π" : 
                fastMA < slowMA and slowMA < longMA ? "–ù–∏—Å—Ö–æ–¥—è—â–∏–π" : 
                "–°–º–µ—à–∞–Ω–Ω—ã–π"
                
    trendColor = trendText == "–í–æ—Å—Ö–æ–¥—è—â–∏–π" ? color.new(buyColor, 70) : 
                trendText == "–ù–∏—Å—Ö–æ–¥—è—â–∏–π" ? color.new(sellColor, 70) : 
                color.new(color.gray, 70)
                
    table.cell(dashboardTable, 0, 1, "–¢—Ä–µ–Ω–¥:", text_color=color.white)
    table.cell(dashboardTable, 1, 1, trendText, bgcolor=trendColor, text_color=color.white)
    
    // –ú–¢–§-—Ç—Ä–µ–Ω–¥
    if useMTF
        mtfTrendText = higher_trend > 0 ? "–í–æ—Å—Ö–æ–¥—è—â–∏–π" : 
                      higher_trend < 0 ? "–ù–∏—Å—Ö–æ–¥—è—â–∏–π" : 
                      "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π"
                      
        mtfTrendColor = higher_trend > 0 ? color.new(buyColor, 70) : 
                       higher_trend < 0 ? color.new(sellColor, 70) : 
                       color.new(color.gray, 70)
                       
        table.cell(dashboardTable, 0, 2, "MTF –¢—Ä–µ–Ω–¥:", text_color=color.white)
        table.cell(dashboardTable, 1, 2, mtfTrendText, bgcolor=mtfTrendColor, text_color=color.white)
    else
        table.cell(dashboardTable, 0, 2, "MTF –¢—Ä–µ–Ω–¥:", text_color=color.white)
        table.cell(dashboardTable, 1, 2, "–í—ã–∫–ª—é—á–µ–Ω", text_color=color.white)
    
    // RSI
    rsiColor = rsiValue > rsiOverbought ? color.new(sellColor, 70) :
              rsiValue < rsiOversold ? color.new(buyColor, 70) :
              color.new(color.gray, 70)
              
    table.cell(dashboardTable, 0, 3, "RSI:", text_color=color.white)
    table.cell(dashboardTable, 1, 3, str.tostring(math.round(rsiValue, 1)), bgcolor=rsiColor, text_color=color.white)
    
    // MACD
    macdText = macdLine > signalLine ? "–ë—ã—á–∏–π" : "–ú–µ–¥–≤–µ–∂–∏–π"
    macdColor = macdLine > signalLine ? color.new(buyColor, 70) : color.new(sellColor, 70)
    
    table.cell(dashboardTable, 0, 4, "MACD:", text_color=color.white)
    table.cell(dashboardTable, 1, 4, macdText, bgcolor=macdColor, text_color=color.white)
    
    // –û–±—ä–µ–º
    if useVolume
        volText = vol_ratio > 1.5 ? "–û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π" :
                 vol_ratio > 1.2 ? "–í—ã—Å–æ–∫–∏–π" :
                 vol_ratio < 0.8 ? "–ù–∏–∑–∫–∏–π" : "–°—Ä–µ–¥–Ω–∏–π"
                 
        volColor = vol_ratio > 1.2 ? color.new(color.blue, 70) :
                  vol_ratio < 0.8 ? color.new(color.gray, 70) :
                  color.new(color.white, 90)
                  
        table.cell(dashboardTable, 0, 5, "–û–±—ä–µ–º:", text_color=color.white)
        table.cell(dashboardTable, 1, 5, volText, bgcolor=volColor, text_color=color.white)
    else
        table.cell(dashboardTable, 0, 5, "–û–±—ä–µ–º:", text_color=color.white)
        table.cell(dashboardTable, 1, 5, "–í—ã–∫–ª—é—á–µ–Ω", text_color=color.white)
    
    // ML/–ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑
    predText = prediction > 0.5 ? "–°–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç" :
              prediction > 0.2 ? "–í–µ—Ä–æ—è—Ç–Ω–æ —Ä–æ—Å—Ç" :
              prediction < -0.5 ? "–°–∏–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ" :
              prediction < -0.2 ? "–í–µ—Ä–æ—è—Ç–Ω–æ —Å–Ω–∏–∂–µ–Ω–∏–µ" :
              "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π"
              
    predColor = prediction > 0.2 ? color.new(buyColor, 70) :
               prediction < -0.2 ? color.new(sellColor, 70) :
               color.new(color.gray, 70)
               
    table.cell(dashboardTable, 0, 6, "–ü—Ä–æ–≥–Ω–æ–∑:", text_color=color.white)
    table.cell(dashboardTable, 1, 6, predText, bgcolor=predColor, text_color=color.white)
    
    // –°–∏–≥–Ω–∞–ª—ã
    signalText = strongBuy ? "–°–ò–õ–¨–ù–ê–Ø –ü–û–ö–£–ü–ö–ê" :
                strongSell ? "–°–ò–õ–¨–ù–ê–Ø –ü–†–û–î–ê–ñ–ê" :
                buy_strength > sell_strength and buy_strength > 50 ? "–ü–æ–∫—É–ø–∫–∞" :
                sell_strength > buy_strength and sell_strength > 50 ? "–ü—Ä–æ–¥–∞–∂–∞" :
                "–ù–µ—Ç —Å–∏–≥–Ω–∞–ª–∞"
                
    signalColor = signalText == "–°–ò–õ–¨–ù–ê–Ø –ü–û–ö–£–ü–ö–ê" ? color.new(buyColor, 20) :
                 signalText == "–°–ò–õ–¨–ù–ê–Ø –ü–†–û–î–ê–ñ–ê" ? color.new(sellColor, 20) :
                 signalText == "–ü–æ–∫—É–ø–∫–∞" ? color.new(buyColor, 60) :
                 signalText == "–ü—Ä–æ–¥–∞–∂–∞" ? color.new(sellColor, 60) :
                 color.new(color.gray, 70)
                 
    table.cell(dashboardTable, 0, 7, "–°–∏–≥–Ω–∞–ª:", text_color=color.white)
    table.cell(dashboardTable, 1, 7, signalText, bgcolor=signalColor, text_color=color.white)
    
    // –°–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞
    scoreText = buy_strength > sell_strength ? 
                str.tostring(math.round(buy_strength)) + "/100 ‚Üë" : 
                str.tostring(math.round(sell_strength)) + "/100 ‚Üì"
                
    scoreColor = buy_strength > sell_strength ? color.new(buyColor, math.max(90 - buy_strength, 30)) :
                color.new(sellColor, math.max(90 - sell_strength, 30))
                
    table.cell(dashboardTable, 0, 8, "–°–∏–ª–∞:", text_color=color.white)
    table.cell(dashboardTable, 1, 8, scoreText, bgcolor=scoreColor, text_color=color.white)
    
    // –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è (–¥–ª—è —Ä–µ–∂–∏–º–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)
    if useStrategy
        posText = strategy.position_size > 0 ? "–í –õ–û–ù–ì–ï" :
                 strategy.position_size < 0 ? "–í –®–û–†–¢–ï" :
                 "–ù–µ—Ç –ø–æ–∑–∏—Ü–∏–∏"
                 
        posColor = strategy.position_size > 0 ? color.new(buyColor, 50) :
                  strategy.position_size < 0 ? color.new(sellColor, 50) :
                  color.new(color.gray, 70)
                  
        table.cell(dashboardTable, 0, 9, "–ü–æ–∑–∏—Ü–∏—è:", text_color=color.white)
        table.cell(dashboardTable, 1, 9, posText, bgcolor=posColor, text_color=color.white)
    else
        table.cell(dashboardTable, 0, 9, "üîç", text_color=color.white)
        table.cell(dashboardTable, 1, 9, "v1.0", text_color=color.white)

//------------------------------ –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò ------------------------------//
// QuantumTrade PRO - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ç—Ä–µ–π–¥–∏–Ω–≥–∞
// –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
// 1. –ú—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
// 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —É—Ä–æ–≤–Ω–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
// 3. –ê–Ω–∞–ª–∏–∑ –æ–±—ä–µ–º–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OBV –∏ MFI
// 4. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º (—ç–ª–µ–º–µ–Ω—Ç—ã ML) –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏
// 5. –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Ä–∏—Å–∫–∞–º–∏ (—Å—Ç–æ–ø-–ª–æ—Å—Å, —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç, —Ç—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø)
// 6. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ —Å–∏–ª—ã —Å–∏–≥–Ω–∞–ª–æ–≤
// 7. –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å
// 8. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è